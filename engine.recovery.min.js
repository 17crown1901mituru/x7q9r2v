(()=>{const e="engine_recovery_active",t="recovery_heartbeat",r="engine_recovery_stop",a="recovery_trigger";let o=!1,n=null;const c=()=>{localStorage.setItem(t,Date.now().toString())},l=e=>console.warn("[engine.recovery]",e),i=()=>{const e=document.body.innerText,t=e.includes("入院中"),r=parseInt(localStorage.getItem("sp")||"999",10),o=parseInt(localStorage.getItem("st")||"1",10);"0"===localStorage.getItem(a)?location.href="/use-item-confirm?type=hp":(r<=199&&fetch("/use-item-exec?type=sp").catch(()=>l("[SP回復失敗]")).then(()=>{fetch("/use-item-exec?type=sp").catch(()=>l("[SP再試行失敗]")).then(()=>l("[SP二回目も失敗]"))}),0===o&&fetch("/use-item-exec?type=st").catch(()=>l("[ST回復失敗]")),t&&(document.querySelector('#floatFooterContents img[src*="footer_heal"]')?(localStorage.setItem(a,"1"),document.querySelector('#floatFooterContents img[src*="footer_heal"]').click()):l("自分を回復ボタンが見つかりません")))},s=setInterval(()=>{c();const t=document.body.innerText.includes("抗争中");if(!t&&o)return clearInterval(s),localStorage.setItem(r,Date.now().toString()),localStorage.removeItem(e),console.log("[engine.recovery] 抗争終了 → engine停止");t&&!o&&(o=!0,n=Date.now(),console.log("[engine.recovery] 抗争中表示 → 監視開始")),o&&(Date.now()-n>36e5?(clearInterval(s),localStorage.setItem(r,Date.now().toString()),localStorage.removeItem(e),console.log("[engine.recovery] 監視60分経過 → engine停止")):i())},1e3);localStorage.setItem(e,"1")})();